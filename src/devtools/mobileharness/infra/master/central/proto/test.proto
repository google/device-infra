/*
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

edition = "2023";

package mobileharness.infra.master.central;

import "src/devtools/mobileharness/api/model/proto/device.proto";
import "src/devtools/mobileharness/api/model/proto/test.proto";
import "src/devtools/mobileharness/infra/master/central/proto/quota.proto";

option features.field_presence = IMPLICIT;
option java_package = "com.google.devtools.mobileharness.infra.master.central.proto";
option java_outer_classname = "Test";

enum TestAllocationLatencyType {
  UNKNOWN = 0;

  // The test is pending before the device becomes IDLE.
  TEST_WAIT_FOR_DEVICE = 1;

  // The device is IDLE before the test comes.
  DEVICE_WAIT_FOR_TEST = 2;
}

message TestProfile {
  // Empty but can be extended.
}

// NEXT ID TO USE: 19
message TestCondition {
  // Required:
  .mobileharness.api.model.TestResult result = 1;

  // Required:
  .mobileharness.api.model.TestStatus status = 2;

  // Optional: the allocated devices locators, if the test has successfully
  // allocated any device. This info will be preserved after the test is
  // allocated.
  repeated .mobileharness.api.model.DeviceLocator allocated_device_locator = 3;

  // Optional: the allocated devices features, if the test has successfully
  // allocated any device. This info will be preserved after the test is
  // allocated.
  repeated .mobileharness.api.model.DeviceFeature allocated_device_feature = 18;

  // Required: When the test is firstly added, or reopened to Master. We use
  // this time to calculate the scheduler latency when this test gets an
  // allocation. See b/71722259.
  int64 create_time_ms = 4;

  // Optional: Allocation latency if the test has successfully allocated any
  // device. Calculation method: http://b/71722259#comment3.
  int64 allocation_latency_ms = 5;

  // Optional: Allocation latency type, for understanding the allocation latency
  // under different situations.
  TestAllocationLatencyType allocation_latency_type = 6;

  // Optional: When the test is added to the Master.
  int64 start_time_ms = 7;

  // Optional: When the test is completed.
  int64 end_time_ms = 8;

  // Optional: Duration for how long this test is suspended for quota issues.
  int64 suspended_duration_time_ms = 10;

  // Optional: The quota control result of this test. Only meaningful for shared
  // lab traffic.
  QuotaResult quota_result = 11;

  reserved 9, 12, 13, 14, 15, 16, 17;
}
