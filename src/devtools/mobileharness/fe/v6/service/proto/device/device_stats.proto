/*
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

syntax = "proto3";

package devtools.mobileharness.fe.v6.service.proto.device;

option java_package = "com.google.devtools.mobileharness.fe.v6.service.proto.device";
option java_multiple_files = true;
option java_outer_classname = "DeviceStatsProto";

// Represents the data for the Device Healthiness Statistics card.
message HealthinessStats {
  // Time series data for daily healthiness breakdown.
  repeated DailyHealthiness daily_stats = 1;
  // Aggregated data over the selected period.
  HealthinessSummary aggregated_stats = 2;
}

// Healthiness breakdown for a single day.
message DailyHealthiness {
  // The date in YYYY-MM-DD format.
  string date = 1;
  HealthinessSummary healthiness_summary = 2;
}

// Healthiness statistics summary over the selected period.
message HealthinessSummary {
  // Total percentage of time the device was considered "In Service".
  float in_service_percent = 1;
  // Total percentage of time the device was considered "Out of Service".
  float out_of_service_percent = 2;

  // Represents a breakdown of a specific healthiness category.
  message Breakdown {
    // The healthiness category. This is a secondary classification and not a
    // direct mapping to a device status.
    string category = 1;
    float percent = 2;
  }

  // Breakdown of "In Service" time.
  // Expected categories: "IDLE", "BUSY".
  repeated Breakdown in_service_breakdown = 3;

  // Breakdown of "Out of Service" time.
  // Expected categories: "LAMEDUCK", "INIT", "DYING", "DIRTY", "PREPPING",
  // "MISSING", "FAILED", and "OTHERS".
  // The "OTHERS" category is for out-of-service reasons other than device
  // status, like abnormal device type.
  repeated Breakdown out_of_service_breakdown = 4;
}

// Common statistics containing count and percentage.
message Stats {
  int32 count = 1;
  float percent = 2;
}

// Common breakdown message containing category and stats.
message CategoryStats {
  string category = 1;
  Stats stats = 2;
}

// Represents the data for the Test Result Statistics card.
message TestResultStats {
  // Time series data for daily test results.
  repeated DailyTestResults daily_stats = 1;
  // Aggregated data over the selected period.
  AggregatedTestResults aggregated_stats = 2;
}

// Test results for a single day.
message DailyTestResults {
  // The date in YYYY-MM-DD format.
  string date = 1;
  int32 pass = 2;
  int32 fail = 3;
  int32 error = 4;
  int32 timeout = 5;
  int32 abort = 6;
  int32 skip = 7;
  int32 unknown = 8;
}

// Aggregated test result statistics over the selected period.
message AggregatedTestResults {
  int32 total_tests = 1;
  Stats completion_stats = 2;
  Stats non_completion_stats = 3;

  // Breakdown of "Completion" tests.
  // Expected categories: "PASS", "FAIL".
  repeated CategoryStats completion_breakdown = 4;

  // Breakdown of "Non-Completion" tests.
  // Expected categories: "UNKNOWN", "ERROR", "TIMEOUT", "ABORT", "SKIP".
  repeated CategoryStats non_completion_breakdown = 5;
}

// Represents the data for the Recovery Task Statistics card.
message RecoveryTaskStats {
  // Time series data for daily recovery task outcomes.
  repeated DailyRecoveryTasks daily_stats = 1;
  // Aggregated data over the selected period.
  AggregatedRecoveryTasks aggregated_stats = 2;
}

// Recovery task outcomes for a single day.
message DailyRecoveryTasks {
  // The date in YYYY-MM-DD format.
  string date = 1;
  int32 success = 2;
  int32 fail = 3;
}

// Aggregated recovery task statistics over the selected period.
message AggregatedRecoveryTasks {
  int32 total_tasks = 1;
  // Expected categories: "SUCCESS", "FAIL".
  repeated CategoryStats outcome_breakdown = 2;
}
