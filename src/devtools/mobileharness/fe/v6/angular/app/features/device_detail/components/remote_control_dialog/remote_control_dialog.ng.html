<app-dialog
  title="Remote Control Device"
  subtitle='Device ID: {{ data.deviceId }}'
  width="48rem"
  height="auto"
  footerType="normal"
>
  <mat-dialog-content class="rc-dialog-content">
    <div class="rc-description">
      <mat-icon>info_outline</mat-icon>
      <div class="rc-description-text">
        This action will start an interactive session for device
        <strong>{{ data.deviceId }}</strong> in ACID.<br>During the session, the
        device will be marked as <strong>BUSY</strong> and will be unavailable
        for automated tests until the session ends or times out.
      </div>
    </div>

    <div class="rc-form">
      <div class="rc-grid">
        <div>
          <label class="rc-label"
            >Run As
            <mat-icon
              class="help-icon"
              matTooltip="Your LDAP or MDB group with device permission"
              >help_outline</mat-icon
            ></label
          >
          <mat-form-field appearance="outline" subscriptSizing="dynamic">
            <mat-select [(ngModel)]="runAs">
              @for (option of data.runAsOptions; track option) {
                <mat-option [value]="option.value">{{ option.label }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <label class="rc-label"
            >Timeout (1-12 hours)
            <mat-icon class="help-icon" matTooltip="Session duration. Default 1h, max 12h."
              >help_outline</mat-icon
            ></label
          >
          <mat-form-field appearance="outline" subscriptSizing="dynamic">
            <input
              matInput
              type="number"
              min="1"
              max="12"
              [(ngModel)]="timeoutHours"
              (blur)="validateTimeout()"
              aria-label="Timeout in hours"
            />
            @if(timeoutError) {
              <mat-error>{{timeoutError}}</mat-error>
            }
          </mat-form-field>
        </div>
      </div>

      <div class="rc-grid">
        <div>
          <label class="rc-label"
            >Proxy Type</label
          >
          <mat-form-field appearance="outline" subscriptSizing="dynamic">
            <mat-select [(ngModel)]="proxyType">
              <mat-option value="DEFAULT">Default (Auto-select)</mat-option>
              <mat-option value="TCP">TCP</mat-option>
              <mat-option value="ADB">ADB</mat-option>
              <mat-option value="VNC">VNC</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <label class="rc-label"
            >Video Resolution<mat-icon class="help-icon" matTooltip="Controls video quality"
              >help_outline</mat-icon
            ></label
          >
          <mat-form-field appearance="outline" subscriptSizing="dynamic">
            <mat-select [(ngModel)]="videoResolution">
              <mat-option value="DEFAULT">Default (Native)</mat-option>
              <mat-option value="HIGH">High</mat-option>
              <mat-option value="LOW">Low</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div class="rc-grid">
        <div>
        <label class="rc-label"
          >Max Video Size<mat-icon
            class="help-icon"
            matTooltip="Limits max video dimension (width/height) to save bandwidth."
            >help_outline</mat-icon
          ></label
        >
        <mat-form-field appearance="outline" subscriptSizing="dynamic">
          <mat-select [(ngModel)]="maxVideoSize">
            <mat-option value="DEFAULT">Default (No Limit)</mat-option>
            <mat-option value="1024">1024px</mat-option>
          </mat-select>
        </mat-form-field>
        </div>
      </div>

      <div class="flash-toggle">
        <toggle-switch
          label="Flash device before session"
          labelPosition="left"
          [(checked)]="enableFlash"
          size="medium"
          color="#0b57d0"
        >
        </toggle-switch>
      </div>

      @if(enableFlash) {
        <div class="flash-options">
          <p class="flash-options-title">Flash Options</p>
          <div class="rc-grid">
            <div>
              <label class="rc-label"
                >Branch Name*
                <mat-icon class="help-icon" matTooltip="Android build branch name, e.g., git_main."
                  >help_outline</mat-icon
                ></label
              >
              <mat-form-field appearance="outline" subscriptSizing="dynamic">
                <input
                  matInput
                  [(ngModel)]="flashBranch"
                  placeholder="e.g., git_main"
                  [required]="enableFlash"
                  (blur)="validateFlashBranch()"
                  aria-label="Branch Name for flashing"
                />
                @if(flashBranchError) {
                  <mat-error>{{flashBranchError}}</mat-error>
                }
              </mat-form-field>
            </div>
            <div>
              <label class="rc-label"
                >Build ID*<mat-icon
                  class="help-icon"
                  matTooltip="The specific build number to flash, e.g., 12345678 or P12345678."
                  >help_outline</mat-icon
                ></label
              >
              <mat-form-field appearance="outline" subscriptSizing="dynamic">
                <input
                  matInput
                  [(ngModel)]="flashBuildId"
                  placeholder="e.g., 12345678"
                  [required]="enableFlash"
                  (blur)="validateFlashBuildId()"
                  aria-label="Build ID for flashing"
                />
                @if(flashBuildIdError) {
                  <mat-error>{{flashBuildIdError}}</mat-error>
                }
              </mat-form-field>
            </div>
            <div>
              <label class="rc-label"
                >Build Target*<mat-icon
                  class="help-icon"
                  matTooltip="The build target name, e.g., husky-next-userdebug."
                  >help_outline</mat-icon
                ></label
              >
              <mat-form-field appearance="outline" subscriptSizing="dynamic">
                <input
                  matInput
                  [(ngModel)]="flashBuildTarget"
                  placeholder="e.g., husky-next"
                  [required]="enableFlash"
                  (blur)="validateFlashBuildTarget()"
                  aria-label="Build Target for flashing"
                />
                @if(flashBuildTargetError) {
                  <mat-error>{{flashBuildTargetError}}</mat-error>
                }
              </mat-form-field>
            </div>
          </div>
        </div>
      }
    </div>
  </mat-dialog-content>
  <ng-template #actionsTemplate>
    <div style="flex-grow: 1;"></div>
    <button mat-dialog-close class="dialog-button dialog-button-secondary">
      Cancel
    </button>
    <button
      class="dialog-button dialog-button-primary"
      (click)="startSession()"
      [disabled]="startingSession()"
    >
      @if (startingSession()) {
        <mat-progress-spinner mode="indeterminate" diameter="16"></mat-progress-spinner>
      }
      Start Session
    </button>
  </ng-template>
</app-dialog>
