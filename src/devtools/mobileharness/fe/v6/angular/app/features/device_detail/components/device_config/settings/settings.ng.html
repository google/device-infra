<app-dialog
  [title]="'Device Configuration'"
  [subtitle]="'Editing configuration for ' + deviceId"
  height="90vh"
  width="72rem"
  [hasFooter]="false"
>
  <ng-content header-button>
    <button matIconButton [matMenuTriggerFor]="menu">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="reset()">
        <mat-icon>delete_sweep</mat-icon>
        <span>Clear All & Start Over</span>
      </button>
    </mat-menu>
  </ng-content>

  <div class="configuration-content">
    <nav class="nav-bar">
      @for (nav of navList; track nav.id) {
        <a
          href="#{{ nav.id }}"
          class="nav-item"
          [class.active]="nav.id === activeSection()"
          (click)="setActiveSection($event, nav.id)"
        >
          <span class="material-icons">{{ nav.icon }}</span>
          <span>{{ nav.label }}</span>
        </a>
      }
    </nav>
    <main class="configuration-content-main">
      <div class="main-container">
        @switch (activeSection()) {
          @case ('permissions') {
            <app-permissions
              [(permissions)]="newConfig.permissions"
              workflow="settings"
            ></app-permissions>
          }
          @case ('wifi') {
            <app-wifi [(wifi)]="newConfig.wifi" workflow="settings"></app-wifi>
          }
          @case ('dimensions') {
            <app-dimensions
              [(dimensions)]="newConfig.dimensions"
              (dimensionsChange)="onDimensionsChange($event)"
              workflow="settings"
            ></app-dimensions>
          }
          @case ('stability') {
            <div class="stability-container">
              <h3 class="title">Stability &amp; Reboot</h3>
              <p class="description">
                Fine-tune device behavior during testing.
                <strong
                  >It is safe to leave these at their default values if you are unsure.</strong
                >
              </p>
              <div class="reboot-config space-y-6">
                <div class="form-group">
                  <label for="max-fail" class="form-label">
                    Max Consecutive Failures before Reboot
                    <code class="label-code text-gray-500">(max_consecutive_fail)</code>
                  </label>
                  <input
                    matInput
                    type="number"
                    class="form-input"
                    [(ngModel)]="newConfig.settings.maxConsecutiveFail"
                  />
                  <p class="label-code label-desc text-gray-500">
                    The device will reboot after this many tests fail in a row. The default is 5. A
                    value of 0 or less will cause a reboot after every test, regardless of its
                    outcome.
                  </p>
                </div>
                <div class="form-group">
                  <label for="max-fail" class="form-label">
                    Max Tests between Reboots
                    <code class="label-code text-gray-500">(max_consecutive_test)</code>
                  </label>
                  <input
                    matInput
                    type="number"
                    class="form-input"
                    [(ngModel)]="newConfig.settings.maxConsecutiveTest"
                  />
                  <p class="label-code label-desc text-gray-500">
                    The device will reboot after this many tests have run, pass or fail. The default
                    is 10,000. A value of 0 or less will cause a reboot after every test.
                  </p>
                </div>
              </div>
            </div>
          }
        }
      </div>

      <app-footer [deviceId]="deviceId" class="main-footer">
        <ng-content footer-buttons>
          <button
            class="wizard-button wizard-button-secondary"
            [disabled]="!isCategoryDirty(activeSection())"
            (click)="discard()"
          >
            Discard Changes
          </button>
          <button
            class="wizard-button wizard-button-primary"
            [disabled]="!isCategoryDirty(activeSection()) || saving()"
            (click)="save()"
          >
            @if (saving()) {
              <mat-spinner [diameter]="20" class="wizard-button-spinner"></mat-spinner>
              Saving...
            } @else {
              Save
            }
          </button>
        </ng-content>
      </app-footer>
    </main>
  </div>
</app-dialog>
